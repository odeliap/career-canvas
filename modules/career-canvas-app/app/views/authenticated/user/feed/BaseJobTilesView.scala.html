@import careercanvas.io.model.job._
@import java.sql.Timestamp
@(
    jobInfos: Seq[JobInfo]
)(content: Html)(implicit request: MessagesRequestHeader)

@authenticated.user.AuthenticatedUserLayout("Feed | Career Canvas") {
<div class="main-page">
    <div>
        @request.flash.data.map{ case (name, value) =>
        @if(name.equals("error")) {
        <div class="error-flash">@value</div>
        } else if (name.equals("success")) {
        <div class="success-flash">@value</div>
        } else {
        <div class="info-flash">@value</div>
        }
        }
    </div>

    <div class="arrows-container">
        <button class="arrow-box arrow-left-end status-filter" id="Bookmarked-count" data-filter="Bookmarked">BOOKMARKED</button>
        <button class="arrow-box arrow-right-left status-filter" id="Applying-count" data-filter="Applying">APPLYING</button>
        <button class="arrow-box arrow-right-left status-filter" id="Applied-count" data-filter="Applied">APPLIED</button>
        <button class="arrow-box arrow-right-left status-filter" id="Interviewing-count" data-filter="Interviewing">INTERVIEWING</button>
        <button class="arrow-box arrow-right-left status-filter" id="Offer-count" data-filter="Offer">OFFER</button>
        <button class="arrow-box arrow-right-end status-filter" id="Rejected-count" data-filter="Rejection">REJECTION</button>
    </div>

    @content

    <div id="job-search-container">
        <form id="search" action="#">
            <input type="text" class="search-container" id="searchBox" placeholder="Search by title or company" onkeypress="handle" />
        </form>

        <div>
            <select class="filter-param" id="lastUpdate">
                <optgroup label="Last Update">
                    <option value="876600" class="default-opt">All time</option>
                    <option value="168">Last 7 days</option>
                    <option value="72">Last 3 days</option>
                    <option value="24">Last 24 hours</option>
                </optgroup>
            </select>

            <select class="filter-param" id="company">
                <optgroup label="Company">
                    <option value="" class="default-opt">All companies</option>
                    @for(company <- jobInfos.map(info => "^[a-zA-Z0-9 ]*".r.findFirstIn(info.company).getOrElse("")).distinct) {
                        <option value="@company">@company</option>
                    }
                </optgroup>
            </select>

            <select class="filter-param" id="location">
                <optgroup label="Location">
                    <option value="" class="default-opt">All Locations</option>
                    @for(location <- jobInfos.map(info => "^[a-zA-Z0-9 ]*".r.findFirstIn(info.location).getOrElse("")).distinct) {
                        <option value="@location">@location</option>
                    }
                </optgroup>
            </select>

            <input type="checkbox" id="showStarred">
            <label for="showStarred" id="showStarredLabel"></label>
        </div>
    </div>

    <div id="job-tiles">
        @jobInfos.map { jobInfo =>
        <div class="job-tile" data-status="@jobInfo.status.toString" data-company="@{"^[a-zA-Z0-9 ]*".r.findFirstIn(jobInfo.company)}" data-lastupdate="@jobInfo.lastUpdate.getTime" data-location="@{"^[a-zA-Z0-9 ]*".r.findFirstIn(jobInfo.location)}" data-starred="@jobInfo.starred.toString.toLowerCase()">
            <div class="job-tile-header">
                <div class="job-tile-subheader">
                    <div class="job-company">@{"^[a-zA-Z0-9 ]*".r.findFirstIn(jobInfo.company)}</div>
                    <a href="@routes.JobFeedController.starJob(jobInfo.jobId)">
                        @if(jobInfo.starred) {
                        <img src="@routes.Assets.versioned("images/authenticated.user/feed/tile/filledbookmark.png")" class="bookmark-icon">
                        } else {
                        <img src="@routes.Assets.versioned("images/authenticated.user/feed/tile/bookmark.png")" class="bookmark-icon">
                        }
                    </a>
                </div>
                <p class="job-title">@jobInfo.jobTitle</p>
            </div>
            <div class="metadata-fields">
                <div class="metadata">
                    <div class="metadata-tag" style="background-color: @utils.ColorUtils.jobStatusToColor(jobInfo.status);"></div>
                    <img src="@routes.Assets.versioned("images/authenticated.user/feed/tile/status/" + jobInfo.status + ".png")" alt="@{jobInfo.status}" class="metadata-icon">
                    <p class="meta-title">Status:</p>
                    <p class="meta-content">@jobInfo.status.toString.replaceAll("\\d+", "").replaceAll("(.)([A-Z])", "$1 $2")</p>
                </div>
                <div class="metadata">
                    <div class="metadata-tag" style="background-color: @utils.ColorUtils.localDateTimeToColor(jobInfo.lastUpdate.toLocalDateTime);"></div>
                    <img src="@routes.Assets.versioned("images/authenticated.user/feed/tile/calendar.png")" class="metadata-icon">
                    <p class="meta-title">Last Update:</p>
                    <p class="meta-content">
                        @{
                        val now = java.time.LocalDateTime.now()
                        val lastUpdate = jobInfo.lastUpdate.toLocalDateTime
                        val duration = java.time.Duration.between(lastUpdate, now)

                        val formattedTime =
                        if (duration.toSeconds < 60) {
                            "just now"
                        } else if (duration.toMinutes == 1) {
                            "1 minute ago"
                        } else if (duration.toMinutes < 60) {
                            s"${duration.toMinutes} minutes ago"
                        } else if (duration.toHours < 24) {
                            s"${duration.toHours} hours ago"
                        } else {
                            s"${duration.toDays} days ago"
                        }

                        formattedTime
                        }
                    </p>
                </div>
            </div>
            <a href="@routes.IndividualJobController.showJobView(jobInfo)" class="view-job-button">View Job</a>
        </div>
        }
    </div>

    <div class="pagination">
        <button id="prevPage"><img src="@routes.Assets.versioned("images/authenticated.user/feed/pagination/previous.png")" class="pagination-arrow"></button>
        <div id="pageNumbersContainer"></div>
        <button id="nextPage"><img src="@routes.Assets.versioned("images/authenticated.user/feed/pagination/next.png")" class="pagination-arrow"></button>
    </div>

    @FooterTemplate()
    <script src="@routes.Assets.versioned("javascripts/authenticated.user/feed/jobFilters.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/authenticated.user/feed/jobFeedNavigationUnderline.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/authenticated.user/feed/search.js")" type="text/javascript"></script>
</div>
}
