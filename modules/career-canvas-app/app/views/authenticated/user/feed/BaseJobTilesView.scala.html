@import careercanvas.io.model.job._
@(
sortByForm: Form[model.forms.SortByForm],
jobInfos: Seq[JobInfo],
hasNext: Boolean
)(content: Html)(script: Html)(implicit request: MessagesRequestHeader)

@authenticated.user.AuthenticatedUserLayout("Feed | Career Canvas") {
    <div class="main-page">
        <div>
            @request.flash.data.map{ case (name, value) =>
            @if(name.equals("error")) {
            <div class="error-flash">@value</div>
            } else if (name.equals("success")) {
            <div class="success-flash">@value</div>
            } else {
            <div class="info-flash">@value</div>
            }
            }
        </div>

        @content

        <div id="job-tiles-view-options">
            <form id="sortForm" action="@routes.JobFeedController.sortJobs()" method="get">
                @helper.CSRF.formField

                @helper.select(
                sortByForm("sortKey"),
                options = SortKey.values.map(sortKey => sortKey.toString -> s"Sort By ${sortKey.toString.replaceAll("\\d+", "").replaceAll("(.)([A-Z])", "$1 $2")}"),
                '_label -> "",
                'id -> "sort-by-form"
                )
                <input type="submit" style="display: none;" id="submitSortForm">
            </form>

            <div id="starred-view-btn-container">
                <button id="toggle-starred-view">
                    <img src="@routes.Assets.versioned("images/feed/tile/star.png")" class="toggle-star-icon">
                    Starred
                </button>
            </div>
        </div>

        <div class="job-tiles">
            @jobInfos.map { jobInfo =>
            <div class="job-tile" data-starred="@jobInfo.starred.toString.toLowerCase()">
                <div class="job-tile-header">
                    <div class="job-tile-subheader">
                        <a href="@routes.JobFeedController.showJobView(jobInfo)" class="job-company">@jobInfo.company</a>
                        <a href="@routes.JobFeedController.starJob(jobInfo.jobId)">
                            @if(jobInfo.starred) {
                                <img src="@routes.Assets.versioned("images/feed/tile/star.png")" class="star-icon starred">
                            } else {
                                <img src="@routes.Assets.versioned("images/feed/tile/star.png")" class="star-icon">
                            }
                        </a>
                    </div>
                    <p class="job-title">@jobInfo.jobTitle</p>
                </div>
                <div class="metadata-fields">
                    <div class="metadata">
                        <div class="metadata-tag" style="background-color: @utils.ColorUtils.jobStatusToColor(jobInfo.status);"></div>
                        <img src="@routes.Assets.versioned("images/feed/tile/status/" + jobInfo.status + ".png")" alt="@{jobInfo.status}" class="metadata-icon">
                        <p class="meta-title">Status:</p>
                        <p class="meta-content">@jobInfo.status.toString.replaceAll("\\d+", "").replaceAll("(.)([A-Z])", "$1 $2")</p>
                    </div>
                    <div class="metadata">
                        <div class="metadata-tag" style="background-color: @utils.ColorUtils.localDateTimeToColor(jobInfo.lastUpdate.toLocalDateTime);"></div>
                        <img src="@routes.Assets.versioned("images/feed/tile/calendar.png")" class="metadata-icon">
                        <p class="meta-title">Last Update:</p>
                        <p class="meta-content">@jobInfo.lastUpdate.toLocalDateTime.toLocalDate.toString</p>
                    </div>
                </div>
            </div>
            }
        </div>
        @if(hasNext) {
            <div id="load-more-button-container">
                <a href="#" id="load-more-button">Load More</a>
            </div>
        }
        @FooterTemplate()
        <script>
            @script
            const toggleButton = document.getElementById("toggle-starred-view");
            let showingStarred = false;
            toggleButton.addEventListener("click", function() {
                const tiles = document.querySelectorAll(".job-tile");
                tiles.forEach(tile => {
                    if (showingStarred) {
                        tile.style.display = '';
                    } else if (tile.getAttribute("data-starred") !== "true") {
                        tile.style.display = 'none';
                    }
                });

                showingStarred = !showingStarred;
                if (showingStarred) {
                    toggleButton.innerHTML = 'Show All';
                } else {
                    toggleButton.innerHTML = '<img src="@routes.Assets.versioned("images/feed/tile/star.png")" alt="Star Icon" class="toggle-star-icon";" /> Starred';
                }
            });

            document.getElementById("sort-by-form").addEventListener("change", function() {
                document.getElementById("sortForm").submit();
            });
        </script>
    </div>
}