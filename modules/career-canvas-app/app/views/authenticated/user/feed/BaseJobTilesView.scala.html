@import careercanvas.io.model.job._
@(
jobsResult: JobsResult
)(content: Html)(script: Html)(implicit request: MessagesRequestHeader)

@authenticated.user.AuthenticatedUserLayout("Feed | Career Canvas") {
    <div class="main-page">
        <div>
            @request.flash.data.map{ case (name, value) =>
            @if(name.equals("error")) {
            <div class="error-flash">@value</div>
            } else if (name.equals("success")) {
            <div class="success-flash">@value</div>
            } else {
            <div class="info-flash">@value</div>
            }
            }
        </div>

        @content

        <div id="job-tiles-view-options">
            <div id="starred-view-btn-container">
                <button id="toggle-starred-view">
                    <img src="@routes.Assets.versioned("images/feed/tile/bookmark.png")" class="toggle-star-icon">
                    Starred
                </button>
            </div>
        </div>

        <div class="job-tiles">
            @jobsResult.jobs.map { jobInfo =>
            <div class="job-tile" data-starred="@jobInfo.starred.toString.toLowerCase()">
                <div class="job-tile-header">
                    <div class="job-tile-subheader">
                        <div class="job-company">@jobInfo.company</div>
                        <a href="@routes.JobFeedController.starJob(jobInfo.jobId)">
                            @if(jobInfo.starred) {
                                <img src="@routes.Assets.versioned("images/feed/tile/bookmark.png")" class="star-icon starred">
                            } else {
                                <img src="@routes.Assets.versioned("images/feed/tile/bookmark.png")" class="star-icon">
                            }
                        </a>
                    </div>
                    <p class="job-title">@jobInfo.jobTitle</p>
                </div>
                <div class="metadata-fields">
                    <div class="metadata">
                        <div class="metadata-tag" style="background-color: @utils.ColorUtils.jobStatusToColor(jobInfo.status);"></div>
                        <img src="@routes.Assets.versioned("images/feed/tile/status/" + jobInfo.status + ".png")" alt="@{jobInfo.status}" class="metadata-icon">
                        <p class="meta-title">Status:</p>
                        <p class="meta-content">@jobInfo.status.toString.replaceAll("\\d+", "").replaceAll("(.)([A-Z])", "$1 $2")</p>
                    </div>
                    <div class="metadata">
                        <div class="metadata-tag" style="background-color: @utils.ColorUtils.localDateTimeToColor(jobInfo.lastUpdate.toLocalDateTime);"></div>
                        <img src="@routes.Assets.versioned("images/feed/tile/calendar.png")" class="metadata-icon">
                        <p class="meta-title">Last Update:</p>
                        <p class="meta-content">@jobInfo.lastUpdate.toLocalDateTime.toLocalDate.toString</p>
                    </div>
                </div>
                <a href="@routes.IndividualJobController.showJobView(jobInfo)" class="view-job-button">View Job</a>
            </div>
            }
        </div>
        <div class="pagination">
            @if(jobsResult.currentPage > 1) {
            <a href="@routes.JobFeedController.showJobFeedHome(jobsResult.currentPage - 1)" class="pagination-item"><img src="@routes.Assets.versioned("images/feed/pagination/previous.png")" class="pagination-arrow"></a>
            }

            @for(pageNum <- 1 to jobsResult.totalPages) {
            @if(pageNum == jobsResult.currentPage) {
            <div class="pagination-item current">@pageNum</div>
            } else {
            <a href="@routes.JobFeedController.showJobFeedHome(pageNum)" class="pagination-item">@pageNum</a>
            }
            }

            @if(jobsResult.currentPage < jobsResult.totalPages) {
            <a href="@routes.JobFeedController.showJobFeedHome(jobsResult.currentPage + 1)" class="pagination-item"><img src="@routes.Assets.versioned("images/feed/pagination/next.png")" class="pagination-arrow"></a>
            }
        </div>
        @FooterTemplate()
        <script>
            @script
            const toggleButton = document.getElementById("toggle-starred-view");
            let showingStarred = false;
            toggleButton.addEventListener("click", function() {
                const tiles = document.querySelectorAll(".job-tile");
                tiles.forEach(tile => {
                    if (showingStarred) {
                        tile.style.display = '';
                    } else if (tile.getAttribute("data-starred") !== "true") {
                        tile.style.display = 'none';
                    }
                });

                showingStarred = !showingStarred;
                if (showingStarred) {
                    toggleButton.innerHTML = 'Show All';
                } else {
                    toggleButton.innerHTML = '<img src="@routes.Assets.versioned("images/feed/tile/bookmark.png")" alt="Star Icon" class="toggle-star-icon";" /> Starred';
                }
            });
        </script>
        <script>
            const jobFeedNavUnderline = document.getElementById("job-feed-nav-underline");
            jobFeedNavUnderline.style.display = "block";
        </script>
    </div>
}